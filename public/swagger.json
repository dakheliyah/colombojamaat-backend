{
  "openapi": "3.0.0",
  "info": {
    "title": "Miqaat API",
    "description": "API documentation for Miqaat management system including Census, Events, Sharafs, and related operations",
    "version": "1.0.0",
    "contact": {
      "name": "API Support"
    }
  },
  "servers": [
    {
      "url": "/api",
      "description": "API Base URL"
    }
  ],
  "tags": [
    {
      "name": "Auth Session",
      "description": "Session / ITS from cookie (its_no)"
    },
    {
      "name": "Census",
      "description": "Census data operations"
    },
    {
      "name": "Families",
      "description": "Family summary operations"
    },
    {
      "name": "Users",
      "description": "User operations"
    },
    {
      "name": "Miqaats",
      "description": "Miqaat operations"
    },
    {
      "name": "Miqaat Check Definitions",
      "description": "CRUD for miqaat_check_definitions (department checks)"
    },
    {
      "name": "Miqaat Checks",
      "description": "List and upsert miqaat_checks for a person within a miqaat (Anjuman view)"
    },
    {
      "name": "Events",
      "description": "Event operations"
    },
    {
      "name": "Sharaf Definitions",
      "description": "Sharaf definition operations"
    },
    {
      "name": "Payment Definitions",
      "description": "Payment type definitions per sharaf definition"
    },
    {
      "name": "Sharaf Positions",
      "description": "Sharaf position operations"
    },
    {
      "name": "Sharafs",
      "description": "Sharaf operations"
    },
    {
      "name": "Sharaf Members",
      "description": "Sharaf member operations"
    },
    {
      "name": "Sharaf Clearances",
      "description": "Sharaf clearance operations"
    },
    {
      "name": "Sharaf Payments",
      "description": "Sharaf payment operations"
    },
    {
      "name": "Wajebaat",
      "description": "Wajebaat (Takhmeen / Finance Ada) operations"
    }
  ],
  "paths": {
    "/auth/session": {
      "get": {
        "tags": [
          "Auth Session"
        ],
        "summary": "Get current session ITS number",
        "description": "Reads the its_no cookie from the request, decrypts if needed, and returns the plain ITS number. Requires credentials (cookies). Returns 401 when cookie is missing or invalid.",
        "responses": {
          "200": {
            "description": "Valid session",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "its_no"
                  ],
                  "properties": {
                    "its_no": {
                      "type": "string",
                      "description": "Plain ITS number from cookie",
                      "example": "30361286"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "No valid session (cookie missing or invalid)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "unauthorized"
                    },
                    "message": {
                      "type": "string",
                      "example": "No valid session."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/census": {
      "get": {
        "tags": [
          "Census"
        ],
        "summary": "Get all census records",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/census/search": {
      "get": {
        "tags": [
          "Census"
        ],
        "summary": "Search census records",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "description": "Search query",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/census/{its_id}": {
      "get": {
        "tags": [
          "Census"
        ],
        "summary": "Get census record by ITS ID",
        "parameters": [
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the person"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/census/{its_id}/with-relations": {
      "get": {
        "tags": [
          "Census"
        ],
        "summary": "Get census record with family relationships",
        "parameters": [
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the person"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/census/family/{hof_its}": {
      "get": {
        "tags": [
          "Census"
        ],
        "summary": "Get family members by Head of Family ITS",
        "parameters": [
          {
            "name": "hof_its",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Head of Family ITS ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/families/{hof_its}/summary": {
      "get": {
        "tags": [
          "Families"
        ],
        "summary": "Get family summary",
        "parameters": [
          {
            "name": "hof_its",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Head of Family ITS ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/users/its/{its_no}": {
      "get": {
        "tags": [
          "Users"
        ],
        "summary": "Get user by ITS number",
        "parameters": [
          {
            "name": "its_no",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS number"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats": {
      "get": {
        "tags": [
          "Miqaats"
        ],
        "summary": "Get all miqaats",
        "description": "Returns all miqaats. Each item includes active_status (boolean); only one miqaat can have active_status true at a time.",
        "responses": {
          "200": {
            "description": "Successful response; data is an array of Miqaat (each with active_status)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Miqaat" }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Miqaats"
        ],
        "summary": "Create a new miqaat",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Name of the miqaat"
                  },
                  "date": {
                    "type": "string",
                    "format": "date",
                    "description": "Date of the miqaat"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/active": {
      "get": {
        "tags": ["Miqaats"],
        "summary": "Get the active miqaat",
        "description": "Returns the single miqaat that is currently active (active_status true). Use this to get the current miqaat id for building URLs. Returns 404 if no miqaat is active.",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": { "$ref": "#/components/schemas/Miqaat" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "No active miqaat set",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/miqaats/{id}": {
      "patch": {
        "tags": ["Miqaats"],
        "summary": "Update a miqaat",
        "description": "Update name, dates, description, or active_status. When active_status is set to true, all other miqaats are set inactive (only one can be active at a time).",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "Miqaat ID"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "start_date": { "type": "string", "format": "date" },
                  "end_date": { "type": "string", "format": "date" },
                  "description": { "type": "string", "nullable": true },
                  "active_status": { "type": "boolean", "description": "Set to true to make this the active miqaat (deactivates others)" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": { "$ref": "#/components/schemas/Miqaat" }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Miqaat not found",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Miqaats"],
        "summary": "Update a miqaat (same as PATCH)",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "start_date": { "type": "string", "format": "date" },
                  "end_date": { "type": "string", "format": "date" },
                  "description": { "type": "string", "nullable": true },
                  "active_status": { "type": "boolean" }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": { "$ref": "#/components/schemas/Miqaat" }
                  }
                }
              }
            }
          },
          "404": { "description": "Miqaat not found", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } },
          "422": { "description": "Validation error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ErrorResponse" } } } }
        }
      }
    },
    "/miqaat-check-definitions": {
      "get": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "List miqaat check definitions",
        "description": "Paginated list, optionally filtered by miqaat_id. When miqaat_id is omitted, results are limited to the active miqaat. When miqaat_id is provided, it must be the active miqaat (403 MIQAAT_NOT_ACTIVE otherwise). Ordered by miqaat_id then name.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            },
            "description": "Filter by miqaat (must exist in miqaats table)"
          },
          {
            "name": "user_type",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "BS",
                "Admin",
                "Help Desk",
                "Anjuman",
                "Finance"
              ]
            },
            "description": "Filter by user_type (e.g. Anjuman). Values: BS, Admin, Help Desk, Anjuman, Finance"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Page number (default: 1)"
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "description": "Items per page (default: 15)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "Create a miqaat check definition",
        "description": "Name must be unique within the given miqaat.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "miqaat_id",
                  "name"
                ],
                "properties": {
                  "miqaat_id": {
                    "type": "integer",
                    "description": "ID of the miqaat"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Name (unique per miqaat)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error or duplicate name for miqaat",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaat-check-definitions/{mcd_id}": {
      "get": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "Get a single miqaat check definition",
        "parameters": [
          {
            "name": "mcd_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Primary key of the check definition"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "Update a miqaat check definition",
        "parameters": [
          {
            "name": "mcd_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "miqaat_id",
                  "name"
                ],
                "properties": {
                  "miqaat_id": {
                    "type": "integer"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "Update a miqaat check definition",
        "parameters": [
          {
            "name": "mcd_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "miqaat_id",
                  "name"
                ],
                "properties": {
                  "miqaat_id": {
                    "type": "integer"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Miqaat Check Definitions"
        ],
        "summary": "Delete a miqaat check definition",
        "description": "If miqaat_checks reference this definition, their mcd_id is set to null.",
        "parameters": [
          {
            "name": "mcd_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/events": {
      "get": {
        "tags": [
          "Events"
        ],
        "summary": "Get all events",
        "description": "Returns only events for the active miqaat.",
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Events"
        ],
        "summary": "Create a new event",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "miqaat_id": {
                    "type": "integer",
                    "description": "ID of the miqaat"
                  },
                  "name": {
                    "type": "string",
                    "description": "Name of the event"
                  }
                },
                "required": [
                  "miqaat_id",
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/events/{event_id}/sharaf-definitions": {
      "get": {
        "tags": [
          "Events",
          "Sharaf Definitions"
        ],
        "summary": "Get sharaf definitions for an event",
        "parameters": [
          {
            "name": "event_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Event ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/events/{miqaat_id}": {
      "get": {
        "tags": [
          "Events"
        ],
        "summary": "Get events by miqaat ID",
        "description": "miqaat_id must be the current active miqaat (403 MIQAAT_NOT_ACTIVE otherwise).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID (must be the active miqaat)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "403": {
            "description": "Miqaat is not the current active miqaat",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": false },
                    "error": { "type": "string", "example": "MIQAAT_NOT_ACTIVE" },
                    "message": { "type": "string", "example": "Miqaat is not the current active miqaat." }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-definitions": {
      "post": {
        "tags": [
          "Sharaf Definitions"
        ],
        "summary": "Create a new sharaf definition",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "event_id": {
                    "type": "integer",
                    "description": "ID of the event"
                  },
                  "name": {
                    "type": "string",
                    "description": "Name of the sharaf definition"
                  },
                  "description": {
                    "type": "string",
                    "description": "Description of the sharaf definition"
                  }
                },
                "required": [
                  "event_id",
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-definitions/{sd_id}/sharafs": {
      "get": {
        "tags": [
          "Sharaf Definitions",
          "Sharafs"
        ],
        "summary": "Get sharafs for a sharaf definition",
        "parameters": [
          {
            "name": "sd_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf definition ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-definitions/{id}/positions": {
      "get": {
        "tags": [
          "Sharaf Definitions",
          "Sharaf Positions"
        ],
        "summary": "Get positions for a sharaf definition",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf definition ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-definitions/{id}/payment-definitions": {
      "get": {
        "tags": [
          "Sharaf Definitions",
          "Payment Definitions"
        ],
        "summary": "Get payment definitions for a sharaf definition",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf definition ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Sharaf definition not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-positions": {
      "post": {
        "tags": [
          "Sharaf Positions"
        ],
        "summary": "Create a new sharaf position",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "sharaf_definition_id": {
                    "type": "integer",
                    "description": "ID of the sharaf definition"
                  },
                  "name": {
                    "type": "string",
                    "description": "Name of the position"
                  },
                  "description": {
                    "type": "string",
                    "description": "Description of the position"
                  }
                },
                "required": [
                  "sharaf_definition_id",
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs": {
      "get": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Get all sharafs with optional filtering",
        "description": "Returns only sharafs whose event belongs to the active miqaat.",
        "parameters": [
          {
            "name": "sharaf_definition_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            },
            "description": "Filter by sharaf definition ID"
          },
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "bs_approved",
                "confirmed",
                "rejected",
                "cancelled"
              ]
            },
            "description": "Filter by status"
          },
          {
            "name": "hof_its",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter by Head of Family ITS"
          },
          {
            "name": "member_its",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter by person ITS: return sharafs where this person is HOF or a member (alias: its_id)"
          },
          {
            "name": "its_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter by person ITS: return sharafs where this person is HOF or a member (alias: member_its)"
          },
          {
            "name": "token",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter by token"
          },
          {
            "name": "hof_name",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Filter by HOF full name (joined from census)"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "description": "Page number"
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "description": "Items per page"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Create a new sharaf",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSharafRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}": {
      "get": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Get a single sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Update sharaf details (Full Update)",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateSharafRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Update sharaf details (Partial Update)",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateSharafRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Delete a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/status": {
      "put": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Update sharaf status",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "bs_approved",
                      "confirmed",
                      "rejected",
                      "cancelled"
                    ],
                    "description": "New status"
                  }
                },
                "required": [
                  "status"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Update sharaf status",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "bs_approved",
                      "confirmed",
                      "rejected",
                      "cancelled"
                    ],
                    "description": "New status"
                  }
                },
                "required": [
                  "status"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/evaluate-confirmation": {
      "post": {
        "tags": [
          "Sharafs"
        ],
        "summary": "Evaluate and update sharaf confirmation status",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Evaluated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/members": {
      "get": {
        "tags": [
          "Sharaf Members"
        ],
        "summary": "Get all members assigned to a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Sharaf Members"
        ],
        "summary": "Add a member to a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AddSharafMemberRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Member added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/members/{its}": {
      "delete": {
        "tags": [
          "Sharaf Members"
        ],
        "summary": "Remove a member from a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          },
          {
            "name": "its",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS number of the person to remove"
          }
        ],
        "responses": {
          "200": {
            "description": "Member removed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/payment-definitions": {
      "get": {
        "tags": [
          "Payment Definitions"
        ],
        "summary": "List payment definitions",
        "description": "Paginated list, optionally filtered by sharaf_definition_id.",
        "parameters": [
          {
            "name": "sharaf_definition_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            },
            "description": "Filter by sharaf definition"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Payment Definitions"
        ],
        "summary": "Create a payment definition",
        "description": "Name must be unique per sharaf definition.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "sharaf_definition_id",
                  "name"
                ],
                "properties": {
                  "sharaf_definition_id": {
                    "type": "integer",
                    "description": "ID of the sharaf definition"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "description": {
                    "type": "string",
                    "nullable": true
                  },
                  "user_type": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Department or user type; defaults to Finance"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error or duplicate name",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/payment-definitions/{id}": {
      "put": {
        "tags": [
          "Payment Definitions"
        ],
        "summary": "Update a payment definition",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Payment definition ID"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "sharaf_definition_id": {
                    "type": "integer",
                    "description": "ID of the sharaf definition"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "description": {
                    "type": "string",
                    "nullable": true
                  },
                  "user_type": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Department or user type"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Payment definition not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error or duplicate name",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Payment Definitions"
        ],
        "summary": "Update a payment definition",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Payment definition ID"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "sharaf_definition_id": {
                    "type": "integer",
                    "description": "ID of the sharaf definition"
                  },
                  "name": {
                    "type": "string",
                    "maxLength": 255
                  },
                  "description": {
                    "type": "string",
                    "nullable": true
                  },
                  "user_type": {
                    "type": "string",
                    "maxLength": 255,
                    "description": "Department or user type"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Payment definition not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error or duplicate name",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharaf-payments": {
      "get": {
        "tags": [
          "Sharaf Payments"
        ],
        "summary": "List sharaf payments",
        "description": "Paginated list, optionally filtered by sharaf_id. Returns only payments for sharafs that belong to the active miqaat.",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/clearances": {
      "post": {
        "tags": [
          "Sharaf Clearances"
        ],
        "summary": "Toggle clearance status for a sharaf's Head of Family",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "is_cleared": {
                    "type": "boolean",
                    "description": "Whether the clearance is complete"
                  },
                  "cleared_by_its": {
                    "type": "string",
                    "description": "ITS number of the person who cleared it"
                  }
                },
                "required": [
                  "is_cleared"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Clearance updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/lagat": {
      "post": {
        "tags": [
          "Sharaf Payments"
        ],
        "summary": "Toggle lagat payment status for a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "paid": {
                    "type": "boolean",
                    "description": "Whether lagat payment is paid"
                  }
                },
                "required": [
                  "paid"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/najwa": {
      "post": {
        "tags": [
          "Sharaf Payments"
        ],
        "summary": "Toggle najwa ada payment status for a sharaf",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "paid": {
                    "type": "boolean",
                    "description": "Whether najwa ada payment is paid"
                  }
                },
                "required": [
                  "paid"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/payments/{payment_definition_id}": {
      "patch": {
        "tags": [
          "Sharaf Payments"
        ],
        "summary": "Toggle payment status for a sharaf by payment definition",
        "description": "Generic endpoint to toggle payment_status for any payment definition (e.g. Hadiyat, Misaaq, Nikah, Ziyafat, Najwa Raqam). Find or create the sharaf_payments record and update payment_status.",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          },
          {
            "name": "payment_definition_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Payment definition ID (from payment_definitions table)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "paid": {
                    "type": "boolean",
                    "description": "Whether the payment is paid"
                  }
                },
                "required": [
                  "paid"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "description": "Updated sharaf payment record with sharaf and paymentDefinition relations"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Sharaf not found, or payment definition not found / not applicable for this sharaf",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/sharafs/{sharaf_id}/payments": {
      "post": {
        "tags": [
          "Sharaf Payments"
        ],
        "summary": "Create or update a sharaf payment",
        "description": "Creates or updates a payment record for the sharaf. payment_status is set to false. Use PATCH /sharafs/{sharaf_id}/payments/{payment_definition_id} for toggling paid status (or lagat/najwa for backward compatibility).",
        "parameters": [
          {
            "name": "sharaf_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Sharaf ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "payment_definition_id",
                  "payment_amount"
                ],
                "properties": {
                  "payment_definition_id": {
                    "type": "integer",
                    "description": "ID of the payment definition"
                  },
                  "payment_amount": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Payment amount"
                  },
                  "payment_currency": {
                    "type": "string",
                    "maxLength": 3,
                    "default": "LKR",
                    "description": "Currency code (3 chars, e.g. LKR, USD)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created/updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Sharaf not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/wajebaat/takhmeen": {
      "post": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Bulk-save Takhmeen amounts",
        "description": "Bulk-save Takhmeen amounts for multiple members. Supports explicit wg_id control: provide wg_id to tag entry with a group, set wg_id to null for personal entries, or omit wg_id for auto-detection (backward compatibility). If an its_id is passed (as a separate field), the API checks if they belong to a wajebaat_groups and returns all associated members' data. Currency is stored as-is (no conversion at write-time).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TakhmeenStoreRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Takhmeen amounts saved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TakhmeenStoreResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "example": false
                        },
                        "error": {
                          "type": "string",
                          "example": "VALIDATION_ERROR"
                        },
                        "message": {
                          "type": "string",
                          "enum": [
                            "ITS ID is not a member of the specified group",
                            "Isolated members cannot be part of any group",
                            "Group not found"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Group not found (when wg_id is provided but group doesn't exist for this miqaat)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "NOT_FOUND"
                    },
                    "message": {
                      "type": "string",
                      "example": "Group not found"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/takhmeen/csv-upload": {
      "post": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Bulk upload Takhmeen from CSV file",
        "description": "Upload a CSV file to bulk create/update Takhmeen records. The CSV file must contain required columns (its_id, amount) and optional columns (currency, conversion_rate, is_isolated, wg_id). All rows are validated before processing. Returns detailed validation errors if any rows fail validation.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "ID of the miqaat (must be the active miqaat)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "csv_file"
                ],
                "properties": {
                  "csv_file": {
                    "type": "string",
                    "format": "binary",
                    "description": "CSV file containing Takhmeen data (max 10MB)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "CSV file processed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "saved_count": {
                          "type": "integer",
                          "description": "Number of records successfully saved",
                          "example": 10
                        },
                        "saved": {
                          "type": "array",
                          "description": "Array of saved wajebaat records",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "integer",
                                "example": 1
                              },
                              "miqaat_id": {
                                "type": "integer",
                                "example": 1
                              },
                              "its_id": {
                                "type": "string",
                                "example": "123456"
                              },
                              "wg_id": {
                                "type": "integer",
                                "nullable": true,
                                "example": 5
                              },
                              "amount": {
                                "type": "number",
                                "example": 5000.00
                              },
                              "currency": {
                                "type": "string",
                                "example": "LKR"
                              },
                              "conversion_rate": {
                                "type": "number",
                                "example": 1.0
                              },
                              "status": {
                                "type": "boolean",
                                "example": false
                              },
                              "wc_id": {
                                "type": "integer",
                                "nullable": true
                              },
                              "is_isolated": {
                                "type": "boolean",
                                "example": false
                              },
                              "created_at": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "updated_at": {
                                "type": "string",
                                "format": "date-time"
                              }
                            }
                          }
                        },
                        "processing_errors": {
                          "type": "array",
                          "description": "Errors encountered during processing (if any)",
                          "items": {
                            "type": "object",
                            "properties": {
                              "row": {
                                "type": "integer",
                                "example": 5
                              },
                              "its_id": {
                                "type": "string",
                                "example": "123456"
                              },
                              "message": {
                                "type": "string",
                                "example": "Error message"
                              }
                            }
                          }
                        },
                        "warnings": {
                          "type": "string",
                          "example": "Some rows had processing errors"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error - CSV file contains errors",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "CSV_VALIDATION_ERROR"
                    },
                    "message": {
                      "type": "string",
                      "example": "CSV file contains validation errors"
                    },
                    "errors": {
                      "type": "array",
                      "description": "Array of validation errors with line numbers",
                      "items": {
                        "type": "object",
                        "properties": {
                          "line": {
                            "type": "integer",
                            "description": "Line number in CSV file (1-based, header is line 1)",
                            "example": 3
                          },
                          "field": {
                            "type": "string",
                            "nullable": true,
                            "description": "Field name that failed validation",
                            "example": "its_id"
                          },
                          "message": {
                            "type": "string",
                            "description": "Error message",
                            "example": "ITS ID '12345' not found in census"
                          }
                        }
                      }
                    },
                    "total_errors": {
                      "type": "integer",
                      "description": "Total number of validation errors",
                      "example": 5
                    },
                    "valid_rows": {
                      "type": "integer",
                      "description": "Number of rows that passed validation",
                      "example": 10
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Miqaat is not active",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/wajebaat/takhmeen/csv/sample": {
      "get": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Download sample CSV file for Takhmeen bulk upload",
        "description": "Returns a sample CSV file with example data showing the correct format for bulk uploading Takhmeen records. The file includes all required and optional columns with example values.",
        "responses": {
          "200": {
            "description": "Sample CSV file",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            },
            "headers": {
              "Content-Disposition": {
                "schema": {
                  "type": "string",
                  "example": "attachment; filename=\"takhmeen_upload_sample.csv\""
                }
              }
            }
          }
        }
      }
    },
    "/wajebaat/takhmeen/csv/guidelines": {
      "get": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Get guidelines and rules for CSV upload",
        "description": "Returns comprehensive guidelines, validation rules, and business rules for bulk uploading Takhmeen data via CSV file. Includes information about required/optional columns, validation rules, and business logic.",
        "responses": {
          "200": {
            "description": "Guidelines and rules",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "title": {
                          "type": "string",
                          "example": "Takhmeen CSV Upload Guidelines"
                        },
                        "description": {
                          "type": "string",
                          "example": "Rules and guidelines for bulk uploading Takhmeen data via CSV file"
                        },
                        "required_columns": {
                          "type": "object",
                          "description": "Required columns with descriptions"
                        },
                        "optional_columns": {
                          "type": "object",
                          "description": "Optional columns with descriptions and defaults"
                        },
                        "validation_rules": {
                          "type": "object",
                          "description": "Validation rules for each column"
                        },
                        "business_rules": {
                          "type": "object",
                          "description": "Business rules and constraints"
                        },
                        "file_requirements": {
                          "type": "object",
                          "description": "File format and size requirements"
                        },
                        "sample_file": {
                          "type": "object",
                          "description": "Information about sample file endpoint"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/miqaat-checks": {
      "get": {
        "tags": [
          "Miqaat Checks"
        ],
        "summary": "List miqaat checks for a person by miqaat",
        "description": "Returns all miqaat_checks for a given person (its_id) within the scope of a miqaat. Used by the Anjuman view to show which definitions are cleared/uncleared for the entered ITS number.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID (must be the active miqaat; 403 MIQAAT_NOT_ACTIVE otherwise)"
          },
          {
            "name": "its_id",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the person (census identifier)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response (data: array of miqaat_check rows)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "success",
                    "data"
                  ],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "integer"
                          },
                          "its_id": {
                            "type": "string"
                          },
                          "mcd_id": {
                            "type": "integer"
                          },
                          "is_cleared": {
                            "type": "boolean"
                          },
                          "cleared_by_its": {
                            "type": "string",
                            "nullable": true
                          },
                          "cleared_at": {
                            "type": "string",
                            "format": "date-time",
                            "nullable": true
                          },
                          "notes": {
                            "type": "string",
                            "nullable": true
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "updated_at": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Miqaat is not the current active miqaat (error: MIQAAT_NOT_ACTIVE)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": false },
                    "error": { "type": "string", "example": "MIQAAT_NOT_ACTIVE" },
                    "message": { "type": "string", "example": "Miqaat is not the current active miqaat." }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Miqaat not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "NOT_FOUND"
                    },
                    "message": {
                      "type": "string",
                      "example": "Miqaat not found."
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Missing its_id",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "VALIDATION_ERROR"
                    },
                    "message": {
                      "type": "string",
                      "example": "The its_id parameter is required."
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "Miqaat Checks"
        ],
        "summary": "Upsert a miqaat check (clear/unclear)",
        "description": "Creates or updates a single miqaat_checks row for a person and a check definition. Uniqueness is on (its_id, mcd_id). Used by the Anjuman view when the user toggles clear/unclear for a definition.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID (must be the active miqaat; 403 MIQAAT_NOT_ACTIVE otherwise)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "its_id",
                  "mcd_id",
                  "is_cleared"
                ],
                "properties": {
                  "its_id": {
                    "type": "string",
                    "description": "ITS ID of the person"
                  },
                  "mcd_id": {
                    "type": "integer",
                    "description": "Check definition ID (must belong to this miqaat)"
                  },
                  "is_cleared": {
                    "type": "boolean",
                    "description": "Whether the check is cleared (true) or not (false)"
                  },
                  "cleared_by_its": {
                    "type": "string",
                    "description": "ITS of the user performing the action (e.g. current Anjuman user)",
                    "nullable": true
                  },
                  "notes": {
                    "type": "string",
                    "description": "Optional notes",
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully (data: miqaat_check row)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "success",
                    "data"
                  ],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "its_id": {
                          "type": "string"
                        },
                        "mcd_id": {
                          "type": "integer"
                        },
                        "is_cleared": {
                          "type": "boolean"
                        },
                        "cleared_by_its": {
                          "type": "string",
                          "nullable": true
                        },
                        "cleared_at": {
                          "type": "string",
                          "format": "date-time",
                          "nullable": true
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updated_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "201": {
            "description": "Created successfully (data: miqaat_check row)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": [
                    "success",
                    "data"
                  ],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer"
                        },
                        "its_id": {
                          "type": "string"
                        },
                        "mcd_id": {
                          "type": "integer"
                        },
                        "is_cleared": {
                          "type": "boolean"
                        },
                        "cleared_by_its": {
                          "type": "string",
                          "nullable": true
                        },
                        "cleared_at": {
                          "type": "string",
                          "format": "date-time",
                          "nullable": true
                        },
                        "notes": {
                          "type": "string",
                          "nullable": true
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updated_at": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "403": {
            "description": "Miqaat is not the current active miqaat (error: MIQAAT_NOT_ACTIVE)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": false },
                    "error": { "type": "string", "example": "MIQAAT_NOT_ACTIVE" },
                    "message": { "type": "string", "example": "Miqaat is not the current active miqaat." }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Miqaat or check definition not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "NOT_FOUND"
                    },
                    "message": {
                      "type": "string",
                      "example": "Miqaat or check definition not found."
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error (e.g. missing its_id, mcd_id, or is_cleared)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": [
          "Miqaat Checks"
        ],
        "summary": "Upsert a miqaat check (clear/unclear)",
        "description": "Same as PUT: creates or updates a single miqaat_checks row. miqaat_id must be the active miqaat (403 MIQAAT_NOT_ACTIVE otherwise). Uniqueness is on (its_id, mcd_id).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID (must be the active miqaat)"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "its_id",
                  "mcd_id",
                  "is_cleared"
                ],
                "properties": {
                  "its_id": {
                    "type": "string"
                  },
                  "mcd_id": {
                    "type": "integer"
                  },
                  "is_cleared": {
                    "type": "boolean"
                  },
                  "cleared_by_its": {
                    "type": "string",
                    "nullable": true
                  },
                  "notes": {
                    "type": "string",
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "201": {
            "description": "Created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "403": {
            "description": "Miqaat is not the current active miqaat (error: MIQAAT_NOT_ACTIVE)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": { "type": "boolean", "example": false },
                    "error": { "type": "string", "example": "MIQAAT_NOT_ACTIVE" },
                    "message": { "type": "string", "example": "Miqaat is not the current active miqaat." }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Miqaat or check definition not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/mumin-profile/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get Mumin Dashboard profile (group or family)",
        "description": "Resolves and returns the full profile for the Mumin Dashboard in one call. Level 1 (Group): If user's ITS is in wajebaat_groups for the miqaat, returns group profile with all members. Level 2 (Family): If not in a group, returns family profile (census where hof_id = user's hof_id). Includes members with census, wajebaat (is_isolated, category), and clearance_status for primary its_id.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "Miqaat ID (must be active)"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "ITS ID of the logged-in mumin"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": {
                      "type": "object",
                      "properties": {
                        "profile_type": { "type": "string", "enum": ["group", "family"] },
                        "master_its": { "type": "string", "description": "Present when profile_type=group" },
                        "hof_its": { "type": "string", "description": "Present when profile_type=family" },
                        "wg_id": { "type": "integer", "description": "Present when profile_type=group" },
                        "group_name": { "type": "string", "nullable": true, "description": "Present when profile_type=group" },
                        "members": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "its_id": { "type": "string" },
                              "person": {
                                "type": "object",
                                "nullable": true,
                                "description": "Census record for the member"
                              },
                              "wajebaat": {
                                "type": "object",
                                "nullable": true,
                                "properties": {
                                  "id": { "type": "integer" },
                                  "amount": { "type": "number" },
                                  "currency": { "type": "string" },
                                  "status": { "type": "boolean" },
                                  "is_isolated": { "type": "boolean" },
                                  "category": {
                                    "type": "object",
                                    "nullable": true,
                                    "properties": {
                                      "wc_id": { "type": "integer" },
                                      "name": { "type": "string" },
                                      "hex_color": { "type": "string" }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        },
                        "clearance_status": {
                          "type": "object",
                          "properties": {
                            "can_mark_paid": { "type": "boolean" },
                            "pending_departments": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "mcd_id": { "type": "integer" },
                                  "name": { "type": "string" }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Census record not found for this ITS",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/by-its-list": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat records for multiple ITSs",
        "description": "Fetches wajebaat records for multiple ITSs in one call. Query param: its_ids=123,456,789 (comma-separated). Returns array of wajebaat objects with is_isolated and category populated.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": { "type": "integer" },
            "description": "Miqaat ID (must be active)"
          },
          {
            "name": "its_ids",
            "in": "query",
            "required": true,
            "schema": { "type": "string" },
            "description": "Comma-separated ITS IDs (e.g. 123,456,789)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response (array of wajebaat with is_isolated and category)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": { "type": "boolean", "example": true },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "its_id": { "type": "string" },
                          "amount": { "type": "number" },
                          "currency": { "type": "string" },
                          "status": { "type": "boolean" },
                          "is_isolated": { "type": "boolean" },
                          "category": {
                            "type": "object",
                            "nullable": true,
                            "properties": {
                              "wc_id": { "type": "integer" },
                              "name": { "type": "string" },
                              "hex_color": { "type": "string" }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ErrorResponse" }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/{its_id}": {
      "get": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Get wajebaat for a member in a miqaat",
        "description": "Returns the single wajebaat record for the given miqaat and member. Includes is_isolated and category (wc_id, name, hex_color). Returns 404 if no record exists.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the member"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "404": {
            "description": "Wajebaat record not found for this miqaat and member",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/related-its/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get all related ITS IDs for a given ITS ID",
        "description": "Finds the person's family (using hof_id from census), gets the hof_its (Head of Family), checks if hof_its has wajebaat grouping for the miqaat, and returns all ITS IDs from both family and wajebaat group.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the person to find related ITS IDs for"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "its_id": {
                          "type": "string",
                          "description": "The original ITS ID that was searched"
                        },
                        "hof_its": {
                          "type": "string",
                          "description": "Head of Family ITS ID"
                        },
                        "family_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "All ITS IDs from the person's family (including HOF)"
                        },
                        "group_member_families_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "All ITS IDs from all group members' families (if person is in a group)"
                        },
                        "all_related_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Combined list of all related ITS IDs (person's family + all group members' families, duplicates removed)"
                        },
                        "group_info": {
                          "type": "object",
                          "nullable": true,
                          "description": "Group information if hof_its is in a wajebaat group",
                          "properties": {
                            "wg_id": {
                              "type": "integer",
                              "description": "Wajebaat Group ID"
                            },
                            "group_name": {
                              "type": "string",
                              "nullable": true,
                              "description": "Group name"
                            },
                            "group_type": {
                              "type": "string",
                              "nullable": true,
                              "enum": ["business_grouping", "personal_grouping", "organization"],
                              "description": "Group type"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "its_id": "20324328",
                    "hof_its": "20324328",
                    "family_its_ids": ["20324328", "30361461"],
                    "group_member_families_its_ids": ["20324223", "30361124", "30361125", "30361462", "30361463", "30362140"],
                    "all_related_its_ids": ["20324328", "30361461", "20324223", "30361124", "30361125", "30361462", "30361463", "30362140"],
                    "group_info": {
                      "wg_id": 7,
                      "group_name": "AKHTARI TRADES (PVT) LTD",
                      "group_type": "business_grouping"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Person not found in census",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "NOT_FOUND",
                  "message": "Person not found in census."
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "VALIDATION_ERROR",
                  "message": "The its id field is required."
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/related/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get all wajebaat records for related ITS IDs (family + group families)",
        "description": "Finds the person's family (using hof_id from census), checks if the person (or their hof_its) is part of a wajebaat group for the miqaat, for each group member gets their family members too, creates a full list of all ITS IDs (person's family + all group members' families), fetches all wajebaat records for those ITS IDs in the given miqaat, and returns all wajebaat records with relationships (category, person, etc.).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the person to find related wajebaat records for"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "its_id": {
                          "type": "string",
                          "description": "The original ITS ID that was searched"
                        },
                        "hof_its": {
                          "type": "string",
                          "description": "Head of Family ITS ID"
                        },
                        "family_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "All ITS IDs from the person's family (including HOF)"
                        },
                        "group_member_families_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "All ITS IDs from all group members' families (if person is in a group)"
                        },
                        "all_related_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "Combined list of all related ITS IDs (person's family + all group members' families, duplicates removed)"
                        },
                        "group_info": {
                          "type": "object",
                          "nullable": true,
                          "description": "Group information if hof_its is in a wajebaat group",
                          "properties": {
                            "wg_id": {
                              "type": "integer",
                              "description": "Wajebaat Group ID"
                            },
                            "group_name": {
                              "type": "string",
                              "nullable": true,
                              "description": "Group name"
                            },
                            "group_type": {
                              "type": "string",
                              "nullable": true,
                              "enum": ["business_grouping", "personal_grouping", "organization"],
                              "description": "Group type"
                            }
                          }
                        },
                        "wajebaats": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": { "type": "integer" },
                              "miqaat_id": { "type": "integer" },
                              "its_id": { "type": "string" },
                              "wg_id": { "type": "integer", "nullable": true },
                              "amount": { "type": "number", "format": "decimal" },
                              "currency": { "type": "string" },
                              "conversion_rate": { "type": "number", "format": "decimal" },
                              "status": { "type": "boolean" },
                              "wc_id": { "type": "integer", "nullable": true },
                              "is_isolated": { "type": "boolean", "description": "Whether this member is isolated (cannot be part of any group)" },
                              "created_at": { "type": "string", "format": "date-time" },
                              "updated_at": { "type": "string", "format": "date-time" },
                              "category": {
                                "type": "object",
                                "nullable": true,
                                "properties": {
                                  "wc_id": { "type": "integer" },
                                  "miqaat_id": { "type": "integer" },
                                  "name": { "type": "string" },
                                  "low_bar": { "type": "number", "format": "decimal" },
                                  "upper_bar": { "type": "number", "format": "decimal" },
                                  "hex_color": { "type": "string", "nullable": true },
                                  "currency": { "type": "string" },
                                  "order": { "type": "integer" }
                                }
                              }
                            }
                          },
                          "description": "All wajebaat records for the related ITS IDs in the given miqaat"
                        }
                      }
                    }
                  }
                },
                "example": {
                  "success": true,
                  "data": {
                    "its_id": "20324328",
                    "hof_its": "20324328",
                    "family_its_ids": ["20324328", "30361461"],
                    "group_member_families_its_ids": ["20324223", "30361124", "30361125", "30361462", "30361463", "30362140"],
                    "all_related_its_ids": ["20324328", "30361461", "20324223", "30361124", "30361125", "30361462", "30361463", "30362140"],
                    "group_info": {
                      "wg_id": 7,
                      "group_name": "AKHTARI TRADES (PVT) LTD",
                      "group_type": "business_grouping"
                    },
                    "wajebaats": [
                      {
                        "id": 1,
                        "miqaat_id": 1,
                        "its_id": "20324328",
                        "wg_id": 7,
                        "amount": "5300000.00",
                        "currency": "LKR",
                        "conversion_rate": "1.000000",
                        "status": false,
                        "wc_id": 5,
                        "is_isolated": false,
                        "created_at": "2026-01-30T22:09:30.000000Z",
                        "updated_at": "2026-01-30T22:09:30.000000Z",
                        "category": {
                          "wc_id": 5,
                          "miqaat_id": 1,
                          "name": "Najmi",
                          "low_bar": "400000.00",
                          "upper_bar": "699999.99",
                          "hex_color": null,
                          "currency": "INR",
                          "order": 3
                        }
                      }
                    ]
                  }
                }
              }
            }
          },
          "404": {
            "description": "Person not found in census",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "NOT_FOUND",
                  "message": "Person not found in census."
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "VALIDATION_ERROR",
                  "message": "The its id field is required."
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/{its_id}/aggregated-amounts": {
      "get": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Get aggregated amounts (LKR and INR) for a member",
        "description": "Returns the final aggregated amount in LKR and INR for a member without categorizing. Handles three scenarios: 1) Individual (if is_isolated=true): returns their own amount, 2) Group (if member is a group master): aggregates all group members' families' wajebaat amounts, 3) Family (if member is a normal HoF): aggregates all family members' wajebaat amounts. All amounts are converted to both LKR and INR for display.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the member"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response with aggregated amounts",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                },
                "example": {
                  "success": true,
                  "data": {
                    "its_id": "20324138",
                    "hof_its_id": "20324138",
                    "type": "group",
                    "is_isolated": false,
                    "total_amount_lkr": 5000.00,
                    "total_amount_inr": 1470.59,
                    "details": {
                      "master_its": "20324138",
                      "wg_id": 1,
                      "group_members": ["20324138", "20324375", "30359434"],
                      "family_members_count": 10,
                      "wajebaat_records_count": 1,
                      "breakdown": [
                        {
                          "its_id": "20324138",
                          "amount": 5000.00,
                          "currency": "LKR",
                          "amount_lkr": 5000.00,
                          "amount_inr": 1470.59
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Person not found in census",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/{its_id}/categorize": {
      "post": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Re-categorize wajebaat record(s) for a specific member",
        "description": "Re-runs the categorization logic for wajebaat records of a specific member. Useful when currency conversion rates are updated or category definitions are changed. Converts amount to INR and matches against category slabs.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the member"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response with categorization results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                },
                "example": {
                  "success": true,
                  "data": {
                    "categorized_count": 1,
                    "errors_count": 0,
                    "categorized": [
                      {
                        "id": 13,
                        "its_id": "30361119",
                        "amount": "21000.00",
                        "currency": "LKR",
                        "old_wc_id": null,
                        "new_wc_id": 5
                      }
                    ],
                    "errors": []
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/categorize": {
      "post": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Re-categorize all wajebaat records for a miqaat",
        "description": "Re-runs the categorization logic for all wajebaat records in a miqaat. Useful for bulk re-categorization when currency conversion rates are updated or category definitions are changed. Converts all amounts to INR and matches against category slabs.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response with categorization results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                },
                "example": {
                  "success": true,
                  "data": {
                    "categorized_count": 13,
                    "errors_count": 0,
                    "categorized": [
                      {
                        "id": 1,
                        "its_id": "20324216",
                        "amount": "1000.00",
                        "currency": "LKR",
                        "old_wc_id": null,
                        "new_wc_id": 5
                      }
                    ],
                    "errors": []
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/{its_id}/clearance": {
      "get": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Get clearance status for a member in a miqaat (HoF level)",
        "description": "Returns wajebaat record (if any), pending department checks, and whether the member can be marked paid. This endpoint implements the 'Department Guard' logic at the Head of Family (HoF) level. When an its_id is received, the system: 1) Gets the HoF its_id from the person's census record, 2) Checks miqaat_checks for the HoF, 3) If the HoF is part of a wajebaat group, checks clearance for all group members' HoF its_ids as well. The response includes hof_its_id, hof_clearance_status (array showing clearance for each relevant HoF), and combined pending_departments. If any HoF has pending departments, can_mark_paid will be false.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response (data: wajebaat, hof_its_id, hof_clearance_status, pending_departments, can_mark_paid)",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                },
                "example": {
                  "success": true,
                  "data": {
                    "wajebaat": {
                      "id": 5,
                      "miqaat_id": 1,
                      "its_id": "20324138",
                      "wg_id": 1,
                      "amount": "5000.00",
                      "currency": "LKR",
                      "status": false,
                      "wc_id": null
                    },
                    "hof_its_id": "20324138",
                    "hof_clearance_status": [
                      {
                        "hof_its_id": "20324138",
                        "pending_departments": [
                          {
                            "mcd_id": 1,
                            "name": "Anjuman Clearance",
                            "user_type": "Anjuman"
                          }
                        ],
                        "can_mark_paid": false
                      },
                      {
                        "hof_its_id": "20324375",
                        "pending_departments": [],
                        "can_mark_paid": true
                      }
                    ],
                    "pending_departments": [
                      {
                        "mcd_id": 1,
                        "name": "Anjuman Clearance",
                        "user_type": "Anjuman"
                      }
                    ],
                    "can_mark_paid": false
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat/{its_id}/paid": {
      "patch": {
        "tags": [
          "Wajebaat"
        ],
        "summary": "Update Finance Ada payment status",
        "description": "Mark a member's wajebaat as paid or unpaid for a specific miqaat. Before saving paid=true, the controller queries the miqaat_checks table. If any check for that its_id is false (or missing), returns 403 Forbidden with a JSON payload listing the specific mcd_id names that are pending.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the member"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "paid"
                ],
                "properties": {
                  "paid": {
                    "type": "boolean",
                    "description": "Whether the wajebaat is paid",
                    "example": true
                  },
                  "is_isolated": {
                    "type": "boolean",
                    "description": "Whether this member is isolated (cannot be part of any group). If set to true, member will be removed from any existing groups.",
                    "nullable": true,
                    "example": false
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Payment status updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SuccessResponse"
                }
              }
            }
          },
          "403": {
            "description": "Department checks are pending",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DepartmentChecksPendingResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get all wajebaat records for a miqaat",
        "description": "Returns all wajebaat records for a specific miqaat. miqaat_id must be the active miqaat (403 MIQAAT_NOT_ACTIVE otherwise). Returns empty array if no records exist (not 404). All other wajebaat endpoints that take miqaat_id also require the active miqaat.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID (must be the active miqaat)"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "miqaat_id": { "type": "integer" },
                          "its_id": { "type": "string" },
                          "wg_id": { "type": "integer", "nullable": true },
                          "amount": { "type": "number", "format": "decimal" },
                          "currency": { "type": "string" },
                          "conversion_rate": { "type": "number", "format": "decimal" },
                          "status": { "type": "boolean" },
                          "wc_id": { "type": "integer", "nullable": true },
                          "is_isolated": { "type": "boolean", "description": "Whether this member is isolated (cannot be part of any group)" },
                          "created_at": { "type": "string", "format": "date-time" },
                          "updated_at": { "type": "string", "format": "date-time" },
                          "category": {
                            "type": "object",
                            "nullable": true,
                            "properties": {
                              "wc_id": { "type": "integer" },
                              "miqaat_id": { "type": "integer" },
                              "name": { "type": "string" },
                              "low_bar": { "type": "number", "format": "decimal" },
                              "upper_bar": { "type": "number", "format": "decimal" },
                              "hex_color": { "type": "string", "nullable": true },
                              "currency": { "type": "string" },
                              "order": { "type": "integer" }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/wajebaat/history/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat history for an ITS ID",
        "description": "Returns all wajebaat records for a specific ITS ID across all miqaats. Ordered by created_at descending (most recent first). Returns empty array if no records exist (not 404).",
        "parameters": [
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID of the member"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer" },
                          "miqaat_id": { "type": "integer" },
                          "its_id": { "type": "string" },
                          "wg_id": { "type": "integer", "nullable": true },
                          "amount": { "type": "number", "format": "decimal" },
                          "currency": { "type": "string" },
                          "conversion_rate": { "type": "number", "format": "decimal" },
                          "status": { "type": "boolean" },
                          "wc_id": { "type": "integer", "nullable": true },
                          "is_isolated": { "type": "boolean", "description": "Whether this member is isolated (cannot be part of any group)" },
                          "created_at": { "type": "string", "format": "date-time" },
                          "updated_at": { "type": "string", "format": "date-time" },
                          "category": {
                            "type": "object",
                            "nullable": true,
                            "properties": {
                              "wc_id": { "type": "integer" },
                              "miqaat_id": { "type": "integer" },
                              "name": { "type": "string" },
                              "low_bar": { "type": "number", "format": "decimal" },
                              "upper_bar": { "type": "number", "format": "decimal" },
                              "hex_color": { "type": "string", "nullable": true },
                              "currency": { "type": "string" },
                              "order": { "type": "integer" }
                            }
                          },
                          "miqaat": {
                            "type": "object",
                            "nullable": true,
                            "properties": {
                              "id": { "type": "integer" },
                              "name": { "type": "string" }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat-categories": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat categories for a miqaat",
        "description": "Returns all wajebaat categories configured for a specific miqaat. Ordered by low_bar ascending. Returns empty array if no categories exist (not 404).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": { "type": "integer", "description": "Category ID (alias for wc_id)" },
                          "wc_id": { "type": "integer" },
                          "miqaat_id": { "type": "integer" },
                          "name": { "type": "string" },
                          "low_bar": { "type": "number", "format": "decimal" },
                          "upper_bar": { "type": "number", "format": "decimal" },
                          "hex_color": { "type": "string", "nullable": true },
                          "color": { "type": "string", "nullable": true, "description": "Alias for hex_color" },
                          "currency": { "type": "string" },
                          "order": { "type": "integer" },
                          "created_at": { "type": "string", "format": "date-time" },
                          "updated_at": { "type": "string", "format": "date-time" }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat-groups": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "List all wajebaat groups for a miqaat",
        "description": "Returns all wajebaat groups for a specific miqaat. Returns empty array if no groups exist (not 404).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/GroupData"
                      }
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Wajebaat"],
        "summary": "Create a new wajebaat group",
        "description": "Creates a new wajebaat group with a master and members. Master ITS must be included in members array. All members must not belong to another group.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["master_its", "member_its_ids"],
                "properties": {
                  "master_its": {
                    "type": "string",
                    "description": "ITS ID of the group master (must exist in census)"
                  },
                  "member_its_ids": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Array of ITS IDs for group members (must exist in census, at least one required)"
                  },
                  "group_name": {
                    "type": "string",
                    "nullable": true,
                    "description": "Optional group name"
                  },
                  "group_type": {
                    "type": "string",
                    "enum": ["business_grouping", "personal_grouping", "organization"],
                    "nullable": true,
                    "description": "Optional group type"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Group created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/GroupData"
                    }
                  }
                }
              }
            }
          },
          "422": {
            "description": "Validation error or isolated member",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "example": false
                        },
                        "error": {
                          "type": "string",
                          "example": "ISOLATED_MEMBER"
                        },
                        "message": {
                          "type": "string",
                          "example": "One or more members are marked as isolated and cannot be part of any group."
                        },
                        "isolated_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Conflict - one or more members already belong to another group",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "CONFLICT"
                    },
                    "message": {
                      "type": "string",
                      "example": "One or more members already belong to another group."
                    },
                    "conflicting_its_ids": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat-groups/by-master/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat group by master ITS ID",
        "description": "Returns the wajebaat group where the specified ITS ID is the master. This is more efficient than fetching all groups and filtering client-side.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID to check if they are a group master"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "wg_id": { "type": "integer" },
                        "master_its": { "type": "string" },
                        "group_name": { "type": "string", "nullable": true },
                        "group_type": { "type": "string", "nullable": true, "enum": ["business_grouping", "personal_grouping", "organization"] },
                        "members": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "its_id": { "type": "string" },
                              "person": {
                                "type": "object",
                                "nullable": true,
                                "description": "Census record for the member"
                              },
                              "wajebaat": {
                                "type": "object",
                                "nullable": true,
                                "description": "Wajebaat record for the member in this miqaat, or null if no record exists"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "No wajebaat group found where this ITS ID is the master",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "NOT_FOUND",
                  "message": "No wajebaat group found where this ITS ID is the master."
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "VALIDATION_ERROR",
                  "message": "Invalid miqaat_id or its_id."
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat-groups/by-member/{its_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat group by member ITS ID",
        "description": "Returns the wajebaat group where the specified ITS ID is a member (not necessarily the master). This allows checking if a person belongs to a group without fetching all groups.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "its_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ITS ID to check if they are a group member"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "wg_id": { "type": "integer" },
                        "master_its": { "type": "string" },
                        "group_name": { "type": "string", "nullable": true },
                        "group_type": { "type": "string", "nullable": true, "enum": ["business_grouping", "personal_grouping", "organization"] },
                        "members": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "its_id": { "type": "string" },
                              "person": {
                                "type": "object",
                                "nullable": true,
                                "description": "Census record for the member"
                              },
                              "wajebaat": {
                                "type": "object",
                                "nullable": true,
                                "description": "Wajebaat record for the member in this miqaat, or null if no record exists"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "No wajebaat group found where this ITS ID is a member",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "NOT_FOUND",
                  "message": "No wajebaat group found where this ITS ID is a member."
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                },
                "example": {
                  "success": false,
                  "error": "VALIDATION_ERROR",
                  "message": "Invalid miqaat_id or its_id."
                }
              }
            }
          }
        }
      }
    },
    "/miqaats/{miqaat_id}/wajebaat-groups/{wg_id}": {
      "get": {
        "tags": ["Wajebaat"],
        "summary": "Get wajebaat group members",
        "description": "Returns all members of a wajebaat group with their census and wajebaat data. Returns 404 if group doesn't exist.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "wg_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Wajebaat Group ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "wg_id": { "type": "integer" },
                        "master_its": { "type": "string" },
                        "group_name": { "type": "string", "nullable": true },
                        "group_type": { "type": "string", "nullable": true, "enum": ["business_grouping", "personal_grouping", "organization"] },
                        "members": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "its_id": { "type": "string" },
                              "person": {
                                "type": "object",
                                "nullable": true,
                                "description": "Census record for the member"
                              },
                              "wajebaat": {
                                "type": "array",
                                "nullable": true,
                                "description": "Array of wajebaat records for the member in this miqaat. A person can have multiple wajebaat records (e.g., personal entry with wg_id=null and group entry with wg_id=group_id). Returns null if no records exist.",
                                "items": {
                                  "type": "object",
                                  "properties": {
                                    "id": { "type": "integer" },
                                    "miqaat_id": { "type": "integer" },
                                    "its_id": { "type": "string" },
                                    "wg_id": { "type": "integer", "nullable": true },
                                    "amount": { "type": "number", "format": "decimal" },
                                    "currency": { "type": "string" },
                                    "conversion_rate": { "type": "number", "format": "decimal" },
                                    "status": { "type": "boolean" },
                                    "wc_id": { "type": "integer", "nullable": true },
                                    "is_isolated": { "type": "boolean" },
                                    "created_at": { "type": "string", "format": "date-time" },
                                    "updated_at": { "type": "string", "format": "date-time" },
                                    "category": {
                                      "type": "object",
                                      "nullable": true,
                                      "properties": {
                                        "wc_id": { "type": "integer" },
                                        "miqaat_id": { "type": "integer" },
                                        "name": { "type": "string" },
                                        "low_bar": { "type": "number", "format": "decimal" },
                                        "upper_bar": { "type": "number", "format": "decimal" },
                                        "hex_color": { "type": "string", "nullable": true },
                                        "currency": { "type": "string" },
                                        "order": { "type": "integer" }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Wajebaat group not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Wajebaat"],
        "summary": "Update an existing wajebaat group",
        "description": "Updates an existing wajebaat group. Can update master, members, group name, or group type. All members must not belong to another group.",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "wg_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Wajebaat Group ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "master_its": {
                    "type": "string",
                    "nullable": true,
                    "description": "ITS ID of the group master (must exist in census)"
                  },
                  "member_its_ids": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "nullable": true,
                    "description": "Array of ITS IDs for group members (must exist in census, at least one if provided)"
                  },
                  "group_name": {
                    "type": "string",
                    "nullable": true,
                    "description": "Optional group name"
                  },
                  "group_type": {
                    "type": "string",
                    "enum": ["business_grouping", "personal_grouping", "organization"],
                    "nullable": true,
                    "description": "Optional group type"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Group updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "data"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/GroupData"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Wajebaat group not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error or isolated member",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "$ref": "#/components/schemas/ErrorResponse"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "example": false
                        },
                        "error": {
                          "type": "string",
                          "example": "ISOLATED_MEMBER"
                        },
                        "message": {
                          "type": "string",
                          "example": "One or more members are marked as isolated and cannot be part of any group."
                        },
                        "isolated_its_ids": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Conflict - one or more members already belong to another group",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string",
                      "example": "CONFLICT"
                    },
                    "message": {
                      "type": "string",
                      "example": "One or more members already belong to another group."
                    },
                    "conflicting_its_ids": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Wajebaat"],
        "summary": "Delete a wajebaat group",
        "description": "Deletes a wajebaat group and sets wajebaat.wg_id to null for all members (cascade).",
        "parameters": [
          {
            "name": "miqaat_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Miqaat ID"
          },
          {
            "name": "wg_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "Wajebaat Group ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Group deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "required": ["success", "message"],
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Wajebaat group deleted successfully."
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Wajebaat group not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "422": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SuccessResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "description": "Response data"
          }
        }
      },
      "ErrorResponse": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "VALIDATION_ERROR"
          },
          "message": {
            "type": "string",
            "example": "The field is required."
          }
        }
      },
      "Miqaat": {
        "type": "object",
        "properties": {
          "id": { "type": "integer", "example": 1 },
          "name": { "type": "string", "example": "Miqaat 2026" },
          "start_date": { "type": "string", "format": "date" },
          "end_date": { "type": "string", "format": "date" },
          "description": { "type": "string", "nullable": true },
          "active_status": { "type": "boolean", "description": "Whether this miqaat is the current active one (only one can be active at a time)", "example": true },
          "created_at": { "type": "string", "format": "date-time" },
          "updated_at": { "type": "string", "format": "date-time" }
        }
      },
      "CreateSharafRequest": {
        "type": "object",
        "required": [
          "sharaf_definition_id",
          "rank",
          "capacity",
          "hof_its"
        ],
        "properties": {
          "sharaf_definition_id": {
            "type": "integer",
            "description": "ID of the sharaf definition (must exist in sharaf_definitions table)",
            "example": 1
          },
          "rank": {
            "type": "integer",
            "description": "Rank of the sharaf (must be unique within the sharaf_definition_id, use 0 for auto-assign)",
            "example": 1
          },
          "capacity": {
            "type": "integer",
            "description": "Maximum number of people in the sharaf (minimum: 1)",
            "minimum": 1,
            "example": 10
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "bs_approved",
              "confirmed",
              "rejected",
              "cancelled"
            ],
            "description": "Status of the sharaf",
            "default": "pending",
            "example": "pending"
          },
          "hof_its": {
            "type": "string",
            "description": "ITS number of the Head of Family",
            "example": "123456"
          },
          "token": {
            "type": "string",
            "maxLength": 50,
            "description": "Unique physical tag/token identifier",
            "example": "T-100"
          },
          "comments": {
            "type": "string",
            "description": "Administrative comments",
            "example": "Requires special seating"
          }
        }
      },
      "UpdateSharafRequest": {
        "type": "object",
        "properties": {
          "sharaf_definition_id": {
            "type": "integer"
          },
          "rank": {
            "type": "integer"
          },
          "capacity": {
            "type": "integer"
          },
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "bs_approved",
              "confirmed",
              "rejected",
              "cancelled"
            ]
          },
          "hof_its": {
            "type": "string"
          },
          "token": {
            "type": "string",
            "maxLength": 50
          },
          "comments": {
            "type": "string"
          }
        }
      },
      "AddSharafMemberRequest": {
        "type": "object",
        "required": [
          "its",
          "position_id"
        ],
        "properties": {
          "its": {
            "type": "string",
            "description": "ITS number of the person to add",
            "example": "123456"
          },
          "position_id": {
            "type": "integer",
            "description": "ID of the sharaf position (must exist in sharaf_positions table)",
            "example": 1
          },
          "sp_keyno": {
            "type": "integer",
            "description": "Key number for ordering within the position",
            "example": 1
          }
        }
      },
      "TakhmeenStoreRequest": {
        "type": "object",
        "required": [
          "miqaat_id",
          "entries"
        ],
        "properties": {
          "miqaat_id": {
            "type": "integer",
            "description": "ID of the miqaat (must be the active miqaat; 403 MIQAAT_NOT_ACTIVE otherwise)",
            "example": 1
          },
          "entries": {
            "type": "array",
            "description": "Array of Takhmeen entries to save (1-1000 items)",
            "minItems": 1,
            "maxItems": 1000,
            "items": {
              "type": "object",
              "required": [
                "its_id",
                "amount"
              ],
              "properties": {
                "its_id": {
                  "type": "string",
                  "description": "ITS ID of the member (must exist in census table)",
                  "example": "123456"
                },
                "amount": {
                  "type": "number",
                  "description": "Takhmeen amount (minimum: 0)",
                  "minimum": 0,
                  "example": 5000.00
                },
                "currency": {
                  "type": "string",
                  "description": "Currency code (3 characters, e.g., LKR, USD)",
                  "minLength": 3,
                  "maxLength": 3,
                  "example": "LKR",
                  "default": "LKR"
                },
                "conversion_rate": {
                  "type": "number",
                  "description": "Conversion rate for reporting purposes only (does not affect stored amount)",
                  "minimum": 0.000001,
                  "example": 1.0,
                  "default": 1.0
                },
                "is_isolated": {
                  "type": "boolean",
                  "description": "Whether this member is isolated (cannot be part of any group). If set to true, member will be removed from any existing groups.",
                  "nullable": true,
                  "example": false
                },
                "wg_id": {
                  "type": "integer",
                  "description": "Optional: Explicitly set the group ID. If provided (not null), the entry will be tagged with this group for aggregation. If null, entry will be saved as personal (wg_id = NULL). If not provided (undefined), backend will use existing auto-detection logic for backward compatibility.",
                  "nullable": true,
                  "example": 5
                }
              }
            }
          },
          "its_id": {
            "type": "string",
            "description": "Optional: If provided, checks if this ITS belongs to a wajebaat_groups and returns all associated members' data",
            "example": "123456"
          }
        }
      },
      "TakhmeenStoreResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": true
          },
          "data": {
            "type": "object",
            "properties": {
              "saved": {
                "type": "array",
                "description": "Array of saved wajebaat records",
                "items": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer",
                      "example": 1
                    },
                    "miqaat_id": {
                      "type": "integer",
                      "example": 1
                    },
                    "its_id": {
                      "type": "string",
                      "example": "123456"
                    },
                    "wg_id": {
                      "type": "integer",
                      "nullable": true,
                      "description": "Group ID if member belongs to a wajebaat group",
                      "example": 5
                    },
                    "amount": {
                      "type": "number",
                      "example": 5000.00
                    },
                    "currency": {
                      "type": "string",
                      "example": "LKR"
                    },
                    "conversion_rate": {
                      "type": "number",
                      "example": 1.0
                    },
                    "status": {
                      "type": "boolean",
                      "description": "Payment status (false = unpaid, true = paid)",
                      "example": false
                    },
                    "wc_id": {
                      "type": "integer",
                      "nullable": true,
                      "description": "Category ID (auto-assigned based on amount)",
                      "example": 2
                    },
                    "is_isolated": {
                      "type": "boolean",
                      "description": "Whether this member is isolated (cannot be part of any group)",
                      "example": false
                    },
                    "created_at": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "updated_at": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              },
              "group": {
                "type": "object",
                "nullable": true,
                "description": "Group data (only present if its_id was provided and member belongs to a group)",
                "properties": {
                  "wg_id": {
                    "type": "integer",
                    "example": 5
                  },
                  "group_name": {
                    "type": "string",
                    "nullable": true,
                    "description": "Name of the group",
                    "example": "Family Group A"
                  },
                  "group_type": {
                    "type": "string",
                    "nullable": true,
                    "enum": [
                      "business_grouping",
                      "personal_grouping",
                      "organization"
                    ],
                    "description": "Type of the group",
                    "example": "personal_grouping"
                  },
                  "master_its": {
                    "type": "string",
                    "example": "123456"
                  },
                  "members": {
                    "type": "array",
                    "description": "All members in the group",
                    "items": {
                      "type": "object",
                      "properties": {
                        "its_id": {
                          "type": "string",
                          "example": "123456"
                        },
                        "person": {
                          "type": "object",
                          "description": "Census record for the member",
                          "nullable": true
                        },
                        "wajebaat": {
                          "type": "object",
                          "description": "Wajebaat record for the member",
                          "nullable": true
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "DepartmentChecksPendingResponse": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "error": {
            "type": "string",
            "example": "DEPARTMENT_CHECKS_PENDING"
          },
          "message": {
            "type": "string",
            "example": "Cannot mark as paid: department checks are pending."
          },
          "pending_departments": {
            "type": "array",
            "description": "List of pending departments with mcd_id and name",
            "items": {
              "type": "object",
              "properties": {
                "mcd_id": {
                  "type": "integer",
                  "description": "Department check ID",
                  "example": 1
                },
                "name": {
                  "type": "string",
                  "description": "Department name",
                  "example": "Finance"
                }
              }
            }
          }
        }
      }
    },
    "GroupData": {
      "type": "object",
      "properties": {
        "wg_id": {
          "type": "integer",
          "description": "Wajebaat Group ID"
        },
        "master_its": {
          "type": "string",
          "description": "ITS ID of the group master"
        },
        "group_name": {
          "type": "string",
          "nullable": true,
          "description": "Group name"
        },
        "group_type": {
          "type": "string",
          "nullable": true,
          "enum": ["business_grouping", "personal_grouping", "organization"],
          "description": "Group type"
        },
        "members": {
          "type": "array",
          "description": "Array of group members",
          "items": {
            "type": "object",
            "properties": {
              "its_id": {
                "type": "string",
                "description": "ITS ID of the member"
              },
              "person": {
                "type": "object",
                "nullable": true,
                "description": "Census record for the member"
              },
              "wajebaat": {
                "type": "object",
                "nullable": true,
                "description": "Wajebaat record for the member in this miqaat, or null if no record exists"
              }
            }
          }
        }
      }
    }
  }
}